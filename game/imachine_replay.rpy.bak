# This is the I-Machine, the flow control script for KS.
# Dedicated to Irina ~<3
# this is the replay version

# Monday
label replay_NOP1:
    call iscene ("NOP1")
    $ replay_end()

label replay_NOP2:
    call iscene ("NOP2")
    $ replay_end()
    
label replay_A1:
    call iscene ("A1")
    call imenu ("choiceA1")
    if _return == m1:
        call iscene ("A1a")
    else:
        call iscene ("A1b")
    call iscene ("A1c")
    $ replay_end()
    
label replay_A2: #we assume hisao has introduced himself
    call iscene ("A2")
    call iscene("A2b")
    call iscene ("A2c")
    call iscene ("A2d")
    call iscene ("A2f")
    $ replay_end()
    
label replay_A3:
    call iscene ("A3")
    call imenu ("choiceA3")
    if _return == m1:
        call iscene ("A3a")
    elif _return == m2:
        call iscene ("A3b") 
    else:
        call iscene ("A3c")
    call iscene ("A3d")
    $ replay_end()
    
label replay_A4:
    call iscene ("A4")
    $ replay_end()


# Tuesday
label replay_A5:
    call iscene ("A5")
    $ replay_end()
    
label replay_A6:
    call iscene ("A6")
    call imenu ("choiceA6")
    if _return == m1:
        call iscene ("A6a")
    else:
        call iscene ("A6b")
    call iscene ("A6c")
    $ replay_end()
    
label replay_A7:
    call iscene ("A7")
    $ replay_end()
    
label replay_A8:
    call iscene ("A8")
    call imenu ("choiceA8")
    if _return == m1:
        call iscene ("A8a")
        call iscene ("A8aa")
        call iscene ("A8ab")
    else:
        call iscene ("A8b")
    call iscene ("A8c")
    if seen_scene ("A8a"): #internal
        call iscene ("A8d")
    else:
        call iscene ("A8e")
    call iscene ("A8f")
    $ replay_end()
    
label replay_A9:
    call iscene ("A9")
    call imenu ("choiceA9")
    if _return == m1:
        call iscene ("A9a")
    else:
        call iscene ("A9b")
    call iscene ("A9c")
    $ replay_end()


# Wednesday
label replay_A10:
    call iscene ("A10")
    call imenu ("choiceA10a")
    if _return == m1:
        call iscene ("A10a")
    elif _return == m2:
        call iscene ("A10b")
    else:
        call iscene ("A10c")
    $ replay_end()
    
label replay_A11_1: # Shizune end is assumed
    call iscene ("A11")
    call iscene ("A11a")
    call iscene ("A11b")
    call iscene ("A11x")
    $ replay_end()
    

label replay_A11_2:
    call iscene ("A11c")
    call iscene ("A11a")
    call iscene ("A11d")
    $ replay_end()
    
label replay_A12:
    call iscene ("A12")
    $ replay_end() 
   
label replay_A13:      
    call iscene ("A13")
    $ replay_end()

#there is no A14

label replay_A15:
    call iscene ("A15")
    $ replay_end()
    
label replay_A16:
    call iscene ("A16")
    $ replay_end()
    
label replay_A17:
    call iscene ("A17")
    call imenu ("choiceA17")
    if _return == m1:
        call iscene ("A17a")
    else:
        call iscene ("A17b")
    call iscene ("A17c")
    $ replay_end()
    
label replay_A18:
    call iscene ("A18")
    $ replay_end()

#Thursday
label replay_A19: # we just go the positive route here
    call iscene ("A19")
    call iscene ("A19a")
    call iscene ("A19c")
    call iscene ("A19j")
    call iscene ("A19d")
    call iscene ("A19f")
    call iscene ("A19g")
    call iscene ("A19h")
    $ replay_end()
    
label replay_A20:
    call iscene ("A20")
    $ replay_end()
    
label replay_A21: #we assume the ending with more lilly
    call iscene ("A21")
    call imenu ("choiceA21")
    if _return == m1:
        call iscene ("A21a")
        $ replay_end()
    call iscene ("A21b")
    call iscene ("A21c")
    $ replay_end()

label replay_A22:
    call iscene ("A22")
    call iscene ("A22a")
    $ replay_end()

label  replay_A22_2:
    call iscene ("A22b")
    $ replay_end()

label replay_A23: #CHECK
    if not seen_scene ("A22a"):
        call iscene ("A23")
    if not seen_scene ("A21c"):
        call iscene ("A23a")
    $ replay_end()

label replay_A24: #CHECK
    if seen_scene ("A21c"):
        call iscene ("A24")
        if seen_scene ("A21a"):
            call iscene ("A24c")
        else:
            call iscene ("A24d")
        call iscene ("A24e")
    if seen_scene("A17a"):
        call iscene ("A24a")
        $ replay_end()
    call iscene ("A24b")
    $ replay_end()

#Friday
label replay_A25:
    call iscene ("A25")
    call imenu ("choiceA25")
    if _return == m1:
        call iscene ("A25b")
        $ replay_end()
    call iscene ("A25a")
    $ replay_end()

label replay_A26: #CHECK
    if not seen_scene ("A25"):
        call iscene ("A26")
    call iscene ("A26a")
    if not seen_scene ("A22b"):
        call iscene ("A26e")
        $ replay_end()
    else:
        call iscene ("A26b")
        call imenu ("choiceA26")
        if _return == m1:
            call iscene ("A26c")
            $ replay_end()
        else:
            call iscene ("A26d")
    $ replay_end()

label replay_A27_1: #CHECK
    call iscene ("A27")
    if seen_scene ("A22b"):
        call iscene ("A27a")
        call imenu ("choiceA27")
        if _return == m1: 
            call iscene ("A27b")
            call iscene ("A27f")
            $ replay_end()
        else:
            call iscene ("A27c")
            if seen_scene ("A25b"):
                call imenu ("choice2A27")
                if _return == m1:
                     call iscene ("A27h")
                     call iscene ("A27e")
                     $ replay_end()                                   
            call iscene ("A27i")
            $ replay_end()
    call iscene ("A27e")
    $ replay_end()

label replay_A27_2: #CHECK
    call iscene ("A27d")
    if seen_scene ("A26d"):
        call iscene ("A27f")
    else:       
        call iscene ("A27e")
    $ replay_end()

label replay_A28: #CHECK
    call iscene ("A28")
    if seen_scene ("A26c"):
        call iscene("A28a")
    call iscene ("A28b")
    $ replay_end()

label replay_A29: #CHECK
    if not seen_scene ("A25b"):
        call iscene ("A29")
        if seen_scene ("A27f"):
            call iscene ("A29x")
    else:
        call iscene ("A29a")
    call iscene ("A29b")
    if seen_scene ("A25b"):
        call iscene ("A29c")
        $ replay_end()
    $ replay_end()

label replay_A30: #CHECK
    call iscene ("A30")
    if seen_scene ("A26d") or seen_scene ("A27b"):
        call iscene ("A30a")
    else:
        call imenu ("choiceA30")
        if _return == m2:
            call iscene ("A30a")
            $ replay_end()
        call iscene ("A30b")
        if seen_scene ("A11c"): #CHECK
            call iscene ("A30c")
    call iscene ("A30d")
    $ replay_end()

#Saturday
label replay_A31: #CHECK
    call iscene ("A31")
    if seen_scene ("A25b"):
        call iscene ("A31b")
    else:
        call iscene ("A31c")
    call iscene ("A31d")
    if attraction_kenji > 0:
        call iscene ("A31e")
    $ replay_end()

label replay_A32:
    call iscene ("A32")
    $ replay_end()

label replay_A33:
    call iscene ("A33")
    call imenu ("choiceA33")
    if _return == m2:
        call iscene ("A33a")
    else:
        call iscene ("A33b")
    $ replay_end()

label replay_A34:
    call iscene ("A34")
    call iscene ("A34a")
    $ replay_end()

label replay_A35:
    call iscene ("A35")
    call imenu("choiceA35")
    if _return == m1:
        call iscene ("A35a")
    $ replay_end()
    
label replay_A36:
    call iscene ("A36")
    $ replay_end()

label replay_A37:
    call iscene ("A37")
    $ replay_end()

#Sunday
label replay_A38: #CHECK
    call iscene ("A38")
    if seen_scene ("A31e"):
        $ replay_end()
    elif seen_scene ("A36"):
        call iscene ("A38a")
        call iscene ("A38e")
        $ replay_end()
    elif seen_scene ("A35") or seen_scene ("A37"):
        call iscene ("A38b")
        call iscene ("A38e")
        $ replay_end()
    elif seen_scene ("A33a"):
        call iscene ("A38c")
        call iscene ("A38e")
        $ replay_end()
    elif seen_scene ("A34"):
        call iscene ("A38d")
        call iscene ("A38e")
        $ replay_end()
    $ replay_end()

label replay_A39:
    call iscene ("A39")
    $ replay_end()

label replay_A40:
    call iscene ("A40")
    $ replay_end()
    
label replay_A41:
    call iscene ("A41")
    if seen_scene ("A37"):
        $ replay_end()
    call iscene ("A41a")
    $ replay_end()
    
label replay_A42:
    call iscene ("A42")
    $ replay_end()

label replay_A43:
    call iscene ("A43")
    $ replay_end()

label replay_A44:
    call iscene ("A44")
    $ replay_end()
